---
title: "Pika-Yak Interactions: Diet Selection"
author: "Douglas Lawton"
date: today
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    fig-cap-location: bottom
    theme: cosmo
editor: source
---

```{r}
#| echo: false
#| results: "hide"
#| message: false
#| warning: false

library(tidyverse)
library(ggpubr)
library(patchwork)
library(here)
library(mgcv)
library(knitr)
library(kableExtra)

# --- Set Root Directory for Project ---
here::i_am("README.md")  # Anchor project for reproducible paths

# --- Custom Color Palette ---
pink <- '#ff8080'
green <- '#2fc09b'

```


```{r}
#| echo: false
#| results: "hide"
#| message: false
#| warning: false


pika_data <- read_csv(here('data/processed/diet_selection/pika_feeding.csv'))
pika_feeding_model_summary <- read_csv(here('data/processed/diet_selection/modeled_data/pika_feeding/model_summary.csv'))
pika_feeding_contrasts <- read_csv(here('data/processed/diet_selection/modeled_data/pika_feeding/posthoc_contrasts.csv'))
pika_feeding_emms <- read_csv(here('data/processed/diet_selection/modeled_data/pika_feeding/emms.csv'))
pika_feeding_letters <- read_csv(here('data/processed/diet_selection/modeled_data/pika_feeding/posthoc_letters.csv'))

yak_data <- read_csv(here('data/processed/diet_selection/yak_grazing.csv'))
yak_feeding_model_summary <- read_csv(here('data/processed/diet_selection/modeled_data/yak_grazing/model_summary.csv'))
yak_feeding_contrasts <- read_csv(here('data/processed/diet_selection/modeled_data/yak_grazing/posthoc_contrasts.csv'))
yak_feeding_emms <- read_csv(here('data/processed/diet_selection/modeled_data/yak_grazing/emms.csv'))
yak_feeding_letters <- read_csv(here('data/processed/diet_selection/modeled_data/yak_grazing/posthoc_letters.csv'))

dung_burrow_by_plot <- read_csv(here('data/processed/diet_selection/dung_burrow_by_plot.csv')) |>
    mutate(plot = factor(plot))

burrow_model <- gam(s_chamaejasme_cover_percent ~
  s(active_pika_burrow_no_100m2, k = 8, bs = 'ts') +
    s(plot, bs = 're'),
  data = dung_burrow_by_plot,
  family = gaussian(),
  select = TRUE
)

gam_ests <- gratia::smooth_estimates(burrow_model)
gam_ests$adj_est <- gam_ests$.estimate + coef(burrow_model)[1]

```

The following figure (@fig-diet_selection_figure) shows pika feeding frequency (A) and yak grazing frequency (B) by each pika and poison plant treatment, with significance indicated by letters. It also shows the relationship between pika burrow density (C) and yak dung density (D) with S. chamaejasme cover. Overall, these results align with those seen in the original figure.

Pikas preferred forbs and S. chamaejasme over grasses and sedges, while yaks preferred grasses, then sedges, then forbs, and completely avoided S. chamaejasme. This pattern is further reinforced by plots C and D.

```{r}
#| label: fig-diet_selection_figure
#| fig-cap: "diet selection"
#| echo: false
#| reulsts: asis'
#| message: false
#| warning: false
#| fig-width: 10
#| fig-height: 8

pika_feeding_plot <- pika_data |>
  left_join(pika_feeding_emms, by = 'plant_group') |>
  ggplot(aes(x = reorder(plant_group, emmean), y = feeding_clipping_freq)) +
  geom_jitter(width = 0.2, height = 0) +
  geom_point(aes(y = emmean), size = 5, color = 'black', pch = 21, fill = 'dark red') +
  geom_text(data = pika_feeding_letters, aes(label = .group, y = 105)) +
  theme_pubr() +
  ylab('feeding/clipping frequency (%)') +
  xlab('')

yak_grazing_plot <- yak_data |>
  left_join(yak_feeding_emms, by = 'plant_group') |>
  mutate(plant_group = factor(plant_group, levels = c('S. chamaejasme', 'Forbs', 'Sedges', 'Grasses'))) |>
  ggplot(aes(x = plant_group, y = grazing_freq)) +
  geom_jitter(width = 0.2, height = 0) +
  geom_point(aes(y = emmean), size = 5, color = 'black', pch = 21, fill = 'dark red') +
  geom_text(data = yak_feeding_letters, aes(label = .group, y = 105)) +
  theme_pubr() +
  ylab('grazing frequency (%)') +
  xlab('') +
  scale_x_discrete(breaks = c('S. chamaejasme', 'Forbs', 'Sedges', 'Grasses'), drop = FALSE)

pika_burrow <- dung_burrow_by_plot |>
  ggplot(aes(x = active_pika_burrow_no_100m2, y = s_chamaejasme_cover_percent)) +
  geom_point() +
  geom_line(data = gam_ests, aes(y = adj_est), linewidth = 1.25, color = 'blue') +
  theme_pubr() +
  xlab('active pika burrow density (no/100m^2)') +
  ylab('S. chamaejasme cover (%)')

dung_plot <- dung_burrow_by_plot |>
  ggplot(aes(x = s_chamaejasme_cover_percent, y = yak_dung_no_100m2)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_pubr() +
  ylab('Dung density (no/100m^2)') +
  xlab('S. chamaejasme cover (%)') +
  ylim(0, 25) +
  xlim(0, 35)


(pika_feeding_plot + yak_grazing_plot) / (pika_burrow + dung_plot) + plot_annotation(tag_levels = 'A') + plot_layout(guides = "collect") & theme(legend.position = 'bottom')


```

# Pika feeding results

There was a significant effect of plant group on pika feeding (@tbl-pika-feeding-model-summary), with S. chamaejasme consumption being the highest, followed by forbs, then sedges and grasses (@tbl-pika-feeding-model-contrasts).

# Yak grazing results

There was a significant effect of plant group on yak grazing (@tbl-yak-feeding-model-summary), with grass consumption being the highest, followed by sedges, and then forbs (@tbl-yak-feeding-model-contrasts).

# Burrow and dung density

I did not run specific statistical models for plots C and D. However, I observed an interesting non-linear relationship between pika burrow density and S. chamaejasme cover. These plots are straightforward and more in-depth tables were not deemed necessary.


```{r}
#| label: tbl-pika-feeding-model-summary
#| tbl-cap: "Model summary for pika feeding."
#| echo: false
#| reulsts: asis'
#| message: false
#| warning: false

library(knitr)
library(kableExtra)

pika_feeding_model_summary |>
  kable(format = "html", booktabs = TRUE, digits = 2) |>
  kable_styling(latex_options = c("striped"))
```

```{r}
#| label: tbl-pika-feeding-model-contrasts
#| tbl-cap: "Estimated marginal means contrasts for pika feeding by plant group."
#| echo: false
#| reulsts: 'asis'
#| message: false
#| warning: false
library(knitr)
library(kableExtra)

pika_feeding_contrasts |>
  kable(format = "html", booktabs = TRUE, digits = 3) |>
  kable_styling(latex_options = c("striped"))


```

```{r}
#| label: tbl-yak-feeding-model-summary
#| tbl-cap: "Model summary for yak grazing by plant group"
#| echo: false
#| reulsts: asis'
#| message: false
#| warning: false

library(knitr)
library(kableExtra)

yak_feeding_model_summary |>
  kable(format = "html", booktabs = TRUE, digits = 2) |>
  kable_styling(latex_options = c("striped"))
```

```{r}
#| label: tbl-yak-feeding-model-contrasts
#| tbl-cap: "Estimated marginal means contrasts for yak grazing by plant group"
#| echo: false
#| reulsts: 'asis'
#| message: false
#| warning: false
library(knitr)
library(kableExtra)

yak_feeding_contrasts |>
  kable(format = "html", booktabs = TRUE, digits = 3) |>
  kable_styling(latex_options = c("striped"))


```