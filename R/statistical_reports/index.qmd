---
title: "Statistical Analyses Overview"
author: "Douglas Lawton"
date: today
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    fig-cap-location: bottom
    theme: cosmo
editor: source
---

# Introduction

This website provides reproducible documentation of all statistical analyses conducted for the manuscript:

**"Density-dependent facilitation of livestock by small mammal ecosystem engineers"**

The study investigates how plateau pikas (*Ochotona curzoniae*) facilitate yak growth and foraging efficiency on the Tibetan Plateau by suppressing the poisonous forb *Stellera chamaejasme*. Through field surveys and manipulative experiments, we demonstrate that pikas enhance forage quantity and quality for yaks, leading to measurable improvements in yak performance.

All analyses were conducted in R using `glmmTMB`, `mgcv`, `emmeans`, and the tidyverse ecosystem. The full analysis workflow, including all code, data, and reproducible reports, is available in the project repository at <https://github.com/ddlawton/pika_yak_interactions>.

## Website Structure

This website contains several interconnected reports:

**Methods and Results** is the primary document containing:

- Complete methods section
- Integrated results and discussion
- All manuscript figures (Figures 1-4)
- Supplementary figures and tables
- Full model summaries and posthoc comparisons

The remaining reports (Diet Selection, Plant Cover, Foraging Efficiency, Foraging Quality) represent earlier exploratory analyses where we developed and refined our statistical approaches. These reports contain detailed model diagnostics, alternative model specifications, and extended visualizations that informed the final analyses presented in the manuscript.

## Data Organization

Analyses are organized by study component:

**Diet Selection (2021 Field Survey)**

- Pika feeding preferences across plant groups
- Yak grazing preferences across plant groups
- Relationship between pika burrow density and *S. chamaejasme* cover
- Relationship between *S. chamaejasme* cover and yak dung density

**Manipulative Experiments (2022-2023)**

- Plant Cover: Effects on forbs, grasses, sedges, and *S. chamaejasme*
- Foraging Efficiency: Yak bite rates, step rates, and bite/step ratios
- Foraging Quality: Crude protein (CP), acid detergent fiber (ADF), and neutral detergent fiber (NDF)
- Yak Performance: Weight gain as a function of treatments and pika burrow density

# Statistical Modeling Framework

## Model Structure

The modeling strategy accounts for the hierarchical structure of the data while maintaining interpretability. The experimental design was fully factorial (pika presence × *S. chamaejasme* presence), and all models included this two-way interaction as the primary fixed effect.

### Experimental Data (2022-2023)

For the manipulative experiments, most models followed this structure:

```{r}
#| label: experimental-model-formula
#| eval: false

response ~ pika_treatment * posion_plant_treatment +
    (1 | block) + 
    (1 | year) + 
    (1 | month)
```

Where:

- `pika_treatment`: pika presence vs. pika exclusion
- `posion_plant_treatment`: *S. chamaejasme* presence vs. *S. chamaejasme* removal
- Random effects account for spatial blocks, interannual variation, and within-season temporal variation

For yak-specific behavioral measurements (e.g., bite rates, step rates), individual yak identity was included:

```{r}
#| label: yak-behavior-model-formula
#| eval: false

response ~ pika_treatment * posion_plant_treatment +
    (1 | block) + 
    (1 | year) + 
    (1 | month) + 
    (1 | yak)
```

### Field Survey Data (2021)

For observational diet selection data, random effects reflected the sampling design:

**Pika feeding frequency:**

```{r}
#| label: pika-feeding-model
#| eval: false

feeding_frequency ~ plant_group + 
    (1 | plot) + 
    (1 | month)
```

**Yak grazing frequency:**

```{r}
#| label: yak-grazing-model
#| eval: false

grazing_frequency ~ plant_group + 
    (1 | transect) + 
    (1 | month)
```

***S. chamaejasme* cover vs. pika burrow density:**

```{r}
#| label: burrow-cover-gam
#| eval: false

s_chamaejasme_cover ~ s(active_pika_burrow_density, k = 8, bs = "ts") +
    s(plot, bs = "re")
```

This generalized additive model (GAM) allows for nonlinear relationships while accounting for spatial variation among plots.

**Yak weight gain vs. pika burrow density:**

```{r}
#| label: weight-burrow-gam
#| eval: false

weight_gain ~ s(active_burrow_count) +
    (1 | block) + 
    (1 | year) + 
    (1 | month)
```

## Statistical Families

Model families were selected based on the distribution and structure of each response variable:

| Family   | Application                                           | Example Variables |
|----------|-------------------------------------------------------|------------------|
| Gaussian | Continuous data with symmetric residuals | Weight gain, bite rates |
| Beta     | Proportions and percentages (0-1 scale, excluding 0 and 1) | Plant cover, foraging quality metrics |
| Tweedie  | Overdispersed, zero-inflated, or right-skewed data | Step counts, bite counts |

For proportion data, we first attempted Beta family models. If convergence failed or model diagnostics were poor, we used Gaussian models on logit-transformed or untransformed proportions. Model selection was guided by residual diagnostics using the `DHARMa` package.

## Posthoc Comparisons

When the pika × *S. chamaejasme* interaction was statistically significant (P < 0.05), we conducted posthoc pairwise comparisons using Tukey HSD or Sidak adjustments via `emmeans`. Estimated marginal means and compact letter displays are reported in the Methods and Results document and supplementary tables.

## Software and Reproducibility

All analyses were conducted in R version 4.3.1 or later. Package management is handled through `renv` to ensure long-term reproducibility. Key packages include:

- `glmmTMB`: Generalized linear mixed models
- `mgcv`: Generalized additive models
- `emmeans`: Estimated marginal means and contrasts
- `DHARMa`: Residual diagnostics for GLMMs
- `tidyverse`: Data manipulation and visualization

Complete package versions are recorded in the `renv.lock` file in the project repository.

---
